saveResults(data) {
                const testData = {
                    test_name: 'pelli_robinson',
                    patient_name: data.patient_name,
                    duration: data.duration,
                    total_points: data.total_points,
                    correct_points: data.correct_points,
                    language: data.language,
                    contrast_sensitivity: data.contrast_sensitivity,
                    log_units: data.log_units,
                    start_time: data.start_time,
                    end_time: data.end_time,
                    responses: data.responses
                };

                console.log('Saving test data:', testData);

                fetch('/api/save_test_result', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                })
                .then(response => {
                    console.log('Response received:', response);
                    console.log('Response status:', response.status);
                    console.log('Response headers:', response.headers);
                    
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP ${response.status}: ${text}`);
                        });
                    }
                    
                    return response.text().then(text => {
                        console.log('Raw response text:', text);
                        try {
                            return JSON.parse(text);
                        } catch (e) {
                            console.error('JSON parse error:', e);
                            throw new Error('Invalid JSON response: ' + text);
                        }
                    });
                })
                .then(result => {
                    console.log('Results saved successfully:', result);
                    alert('Test results saved successfully!');
                })
                .catch(error => {
                    console.error('Error saving results:', error);
                    console.error('Error type:', typeof error);
                    console.error('Error message:', error.message || 'Unknown error');
                    console.error('Full error object:', error);
                    alert('Error saving results: ' + (error.message || 'Unknown error occurred'));
                });
            }